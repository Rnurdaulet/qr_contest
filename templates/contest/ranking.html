{% extends "base.html" %}

{% block title %}–†–µ–π—Ç–∏–Ω–≥{% endblock %}

{% block content %}
    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="page-content header-clear-medium bg-3">

        <div class="card card-style">
            <div class="content">
                <h1>üèÜ –†–µ–π—Ç–∏–Ω–≥</h1>
                <table>
                    <thead>
                    <tr>
                        <th>üìå –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç</th>
                        <th>ü•£ –ë–∞–ª–ª—ã</th>
                    </tr>
                    </thead>
                    <tbody id="department-ranking">
                    <tr>
                        <td colspan="2">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card card-style">
            <div class="content">
                <h1>üèÖ –¢–æ–ø-10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>
                <table>
                    <thead>
                    <tr>
                        <th>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                        <th>ü•£ –ë–∞–ª–ª—ã</th>
                        <th>üìå –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç</th>
                    </tr>
                    </thead>
                    <tbody id="user-ranking">
                    <tr>
                        <td colspan="3">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        async function fetchRanking() {
            try {
                const response = await fetch("/api/ranking/");
                const data = await response.json();

                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤
                const departmentTable = document.getElementById("department-ranking");
                departmentTable.innerHTML = ""; // –û—á–∏—â–∞–µ–º –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

                data.department_ranking.forEach(dept => {
                    const row = `<tr>
                                    <td>${dept.department}</td>
                                    <td>${dept.total_score}</td>
                                </tr>`;
                    departmentTable.innerHTML += row;
                });

                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const userTable = document.getElementById("user-ranking");
                userTable.innerHTML = ""; // –û—á–∏—â–∞–µ–º –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

                data.user_ranking.forEach(user => {
                    const row = `<tr>
                                    <td>${user.username}</td>
                                    <td>${user.score}</td>
                                    <td>${user.department || "-"}</td>
                                </tr>`;
                    userTable.innerHTML += row;
                });

                console.log("–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã");
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–µ–π—Ç–∏–Ω–≥–∞:", error);
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        fetchRanking();

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (300000 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥)
        setInterval(fetchRanking, 500);
    </script>
{% endblock %}



